<!DOCTYPE html>
<html>
<head>
    <title>Debug</title>
</head>
<body>
    <h1>Debug Tone Generator</h1>
    <button id="start">START AUDIO</button>
    <div id="status">Not started</div>
    <br><br>
    
    <select id="effect-test">
        <option value="none">-- No Effect --</option>
        <option value="reverb">Reverb</option>
        <option value="delay">Delay</option>
    </select>
    <div id="params"></div>
    
    <script>
        let audioCtx = null;
        
        document.getElementById('start').addEventListener('click', async () => {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            await audioCtx.resume();
            document.getElementById('status').textContent = 'Audio started! Sample rate: ' + audioCtx.sampleRate;
            
            // Test effect creation
            testEffectCreation();
        });
        
        function testEffectCreation() {
            const select = document.getElementById('effect-test');
            select.addEventListener('change', (e) => {
                const type = e.target.value;
                console.log('Effect selected:', type);
                
                if (type === 'none') {
                    document.getElementById('params').innerHTML = '';
                    return;
                }
                
                try {
                    // Create a simple test effect
                    let effect;
                    if (type === 'reverb') {
                        effect = audioCtx.createConvolver();
                        // Create a simple impulse response
                        const impulse = audioCtx.createBuffer(2, audioCtx.sampleRate * 0.5, audioCtx.sampleRate);
                        for (let channel = 0; channel < 2; channel++) {
                            const data = impulse.getChannelData(channel);
                            for (let i = 0; i < data.length; i++) {
                                data[i] = (Math.random() * 2 - 1) * Math.exp(-3 * i / audioCtx.sampleRate);
                            }
                        }
                        effect.buffer = impulse;
                    } else if (type === 'delay') {
                        effect = audioCtx.createDelay(1.0);
                        effect.delayTime.value = 0.3;
                    }
                    
                    document.getElementById('params').innerHTML = '<p style="color: green;">Effect created: ' + type + '</p>';
                    console.log('Effect created successfully:', effect);
                } catch (err) {
                    document.getElementById('params').innerHTML = '<p style="color: red;">Error: ' + err.message + '</p>';
                    console.error('Error:', err);
                }
            });
        }
    </script>
</body>
</html>
